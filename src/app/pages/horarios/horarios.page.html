<app-navbar></app-navbar>

<ion-content class="ion-padding">
  <ion-list lines="none">
    <ion-list-header>
      <ion-label color="primary"><h2>Configuración de Perfil</h2></ion-label>
    </ion-list-header>
    
    <form [formGroup]="timeForm">
      <ion-item>
        <mat-form-field appearance="outline" style="width: 100%; margin-top: 10px;">
          <mat-label>Hora Entrada General</mat-label>
          <input matInput [matTimepicker]="p1" formControlName="startTime">
          <mat-timepicker-toggle matSuffix [for]="p1"></mat-timepicker-toggle>
          <mat-timepicker #p1></mat-timepicker>
        </mat-form-field>
      </ion-item>

      <ion-item>
        <mat-form-field appearance="outline" style="width: 100%; margin-top: 10px;">
          <mat-label>Hora Salida General</mat-label>
          <input matInput [matTimepicker]="p2" formControlName="endTime">
          <mat-timepicker-toggle matSuffix [for]="p2"></mat-timepicker-toggle>
          <mat-timepicker #p2></mat-timepicker>
        </mat-form-field>
      </ion-item>
    </form>
    
    <ion-button expand="block" (click)="onDateTime()" fill="clear">
      Actualizar Perfil de Usuario
    </ion-button>
  </ion-list>

  <ion-item-divider mode="md"></ion-item-divider>

  <ion-list-header class="ion-margin-top">
    <ion-label color="primary"><h2>Plantilla Semanal de Citas</h2></ion-label>
  </ion-list-header>

  <ion-segment [value]="selectedDayIndex" (ionChange)="onDaySelect($event)" scrollable="true" mode="md" class="ion-margin-bottom">
    <ion-segment-button *ngFor="let day of weekDays" [value]="day.id">
      <ion-label>{{ day.name.substring(0,3) }}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ion-card class="ion-no-margin">
    <ion-card-header>
      <ion-card-title color="dark">Configurar: {{ weekDays[+selectedDayIndex].name }}</ion-card-title>
    </ion-card-header>

    <form [formGroup]="scheduleForm">
      <ion-list lines="full">
        <ion-item>
          <ion-toggle formControlName="isWorking" justify="space-between">
            <ion-label>
              {{ scheduleForm.get('isWorking')?.value ? 'Día Laborable' : 'Día Cerrado' }}
            </ion-label>
          </ion-toggle>
        </ion-item>

        <ng-container *ngIf="scheduleForm.get('isWorking')?.value">
          <ion-grid>
            <ion-row>
              <ion-col size="6">
                <ion-item lines="none">
                  <ion-select label="Entrada" labelPlacement="floating" formControlName="start">
                    <ion-select-option *ngFor="let h of hours" [value]="h">{{ h }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col size="6">
                <ion-item lines="none">
                  <ion-select label="Salida" labelPlacement="floating" formControlName="end">
                    <ion-select-option *ngFor="let h of hours" [value]="h">{{ h }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>

          <ion-item>
            <ion-toggle formControlName="hasBreak" justify="space-between">¿Tiene Almuerzo/Pausa?</ion-toggle>
          </ion-item>

          <ion-grid *ngIf="scheduleForm.get('hasBreak')?.value">
            <ion-row>
              <ion-col size="6">
                <ion-item lines="none">
                  <ion-select label="Inicia" labelPlacement="floating" formControlName="breakStart">
                    <ion-select-option *ngFor="let h of hours" [value]="h">{{ h }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col size="6">
                <ion-item lines="none">
                  <ion-select label="Termina" labelPlacement="floating" formControlName="breakEnd">
                    <ion-select-option *ngFor="let h of hours" [value]="h">{{ h }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ng-container>
      </ion-list>
    </form>
  </ion-card>

  <ion-button expand="block" class="ion-margin-top" (click)="saveSchedule()" [disabled]="isSaving">
    <ion-spinner *ngIf="isSaving" name="crescent" slot="start"></ion-spinner>
    Guardar Plantilla
  </ion-button>

  <ion-button expand="block" color="danger" fill="clear" (click)="clearSchedule()" [disabled]="!currentSchedule || isSaving">
    Resetear día a "Cerrado"
  </ion-button>
</ion-content>